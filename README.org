#+TITLE: meta-agent-shell
#+AUTHOR: Elle Najt

Multi-agent coordination for [[https://github.com/xenodium/agent-shell][agent-shell]]. Dispatchers route work to agents, agents communicate with each other, tasks live in org files that show up in your agenda.

[[file:docs/screenshot.png]]

* What This Does

- *Dispatchers* coordinate multiple agents on a project - spawn agents, route messages, manage lifecycle
- *Inter-agent communication* via simple CLI tools (~agent-send~, ~agent-ask~)
- *Task tracking* in org files (~.tasks/current.org~) - tasks show up in Emacs agenda
- *ICC logging* - all agent-to-agent messages logged as JSONL for debugging/analysis
- *Panic button* - ~M-x meta-agent-shell-interrupt-all~ stops everything

* Setup

#+begin_src bash
./setup.sh
#+end_src

This:
1. Creates =~/.claude-meta/= directory
2. Links the meta-agent CLAUDE.md
3. Tells you what to add to your shell config and =~/.claude/CLAUDE.md=

Then add to your Emacs config:

#+begin_src elisp
(use-package meta-agent-shell
  :after agent-shell)
#+end_src

* Usage

** Start a dispatcher for a project

#+begin_example
M-x meta-agent-shell-start-dispatcher
#+end_example

The dispatcher can spawn agents, assign tasks, and coordinate work.

** Agents communicate via CLI

#+begin_src bash
agent-send "buffer-name" "message"
agent-ask "buffer-name" "question"   # reply routed back automatically
agent-whoami                          # print own buffer name
#+end_src

Agents are taught these tools via =agent-overview.md= (included in setup).

** Task tracking

Dispatchers write tasks to =.tasks/current.org= in the project:

#+begin_src org
** TODO Refactor auth middleware :@claude:
   :PROPERTIES:
   :ASSIGNED: (myproject)-Refactor
   :END:
#+end_src

Add =.tasks/= to your =org-agenda-files= and tasks show up in your agenda.

* How Agent Identity Works

When an agent runs ~agent-whoami~, it passes its shell PID. The system walks up the process tree:

#+begin_example
$$ (shell) → zsh → claude → node (ACP client)
#+end_example

Each agent-shell buffer owns an ACP client process. Match the PID, find the buffer. Agents identify themselves without knowing their buffer name.

* Logging

All inter-agent messages logged to =~/.meta-agent-shell/logs/YYYY-MM-DD-icc.jsonl=:

#+begin_src json
{"timestamp":"2026-02-05T14:32:01","type":"ask","from":"(proj)-A","to":"(proj)-B","message":"..."}
#+end_src

* Heartbeat (Optional)

Periodic status updates to a meta-agent. See =M-x describe-function meta-agent-shell-heartbeat-start=.

* License

GPL-3.0
