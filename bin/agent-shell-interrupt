#!/usr/bin/env bash
# agent-shell-interrupt - Interrupt a running agent
# Usage: agent-shell-interrupt "buffer-name"

if [ $# -lt 1 ] || [ "$1" = "--help" ] || [ "$1" = "-h" ]; then
    echo "Usage: agent-shell-interrupt \"buffer-name\"" >&2
    exit 1
fi

target="$1"

# Escape for elisp: backslashes first, then quotes
escaped_target=$(printf '%s' "$target" | sed 's/\\/\\\\/g; s/"/\\"/g')

emacsclient --eval "(meta-agent-shell-interrupt-session \"$escaped_target\" $$)"
