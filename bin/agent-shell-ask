#!/bin/bash
# agent-shell-ask - Ask another agent a question (they'll reply back to you)
# Usage: agent-shell-ask "target-buffer" "question"
#
# Automatically detects sender from process hierarchy.
# The target agent will receive instructions to reply back to you.

if [ $# -lt 2 ]; then
    echo "Usage: agent-shell-ask \"target-buffer\" \"question\"" >&2
    exit 1
fi

target="$1"
question="$2"
me=$(emacsclient --eval "(meta-agent-shell-whoami $$)" | tr -d '"')

if [ -z "$me" ] || [ "$me" = "nil" ]; then
    echo "Error: Could not determine caller buffer" >&2
    exit 1
fi

emacsclient --eval "(meta-agent-shell-ask-session \"$target\" \"$question\" \"$me\")"
