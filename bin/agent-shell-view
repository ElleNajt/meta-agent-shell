#!/usr/bin/env bash
# agent-shell-view - View recent output from an agent session
# Usage: agent-shell-view "buffer-name" [lines]

if [ $# -lt 1 ]; then
    echo "Usage: agent-shell-view \"buffer-name\" [lines]" >&2
    exit 1
fi

target="$1"
lines="${2:-50}"

# Escape for elisp: backslashes first, then quotes
escaped_target=$(printf '%s' "$target" | sed 's/\\/\\\\/g; s/"/\\"/g')

emacsclient --eval "(meta-agent-shell-view-session \"$escaped_target\" $lines nil $$)"
